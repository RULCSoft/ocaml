From: Pino Toscano <pino@debian.org>
Date: Tue, 27 Mar 2012 11:41:02 +0200
Subject: Fix symbol mangling in asmcomp tests on *-i386 and sparc

Based on a patch by Pino Toscano <pino@debian.org>.

Bug-Debian: http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=661716
Signed-off-by: Stephane Glondu <steph@glondu.net>
---
 testsuite/tests/asmcomp/i386.S  |    3 ++-
 testsuite/tests/asmcomp/sparc.S |    2 +-
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/testsuite/tests/asmcomp/i386.S b/testsuite/tests/asmcomp/i386.S
index fdda4de..c2510c8 100644
--- a/testsuite/tests/asmcomp/i386.S
+++ b/testsuite/tests/asmcomp/i386.S
@@ -15,7 +15,8 @@
 /* Linux with ELF binaries does not prefix identifiers with _.
    Linux with a.out binaries, FreeBSD, and NextStep do. */
 
-#ifdef SYS_linux_elf
+#if defined(SYS_linux_elf) || defined(SYS_bsd_elf) \
+ || defined(SYS_solaris) || defined(SYS_beos) || defined(SYS_gnu)
 #define G(x) x
 #define FUNCTION_ALIGN 16
 #else
diff --git a/testsuite/tests/asmcomp/sparc.S b/testsuite/tests/asmcomp/sparc.S
index 7d17548..aeacaaf 100644
--- a/testsuite/tests/asmcomp/sparc.S
+++ b/testsuite/tests/asmcomp/sparc.S
@@ -12,7 +12,7 @@
 
 /* $Id: sparc.S 11156 2011-07-27 14:17:02Z doligez $ */
 
-#ifndef SYS_solaris
+#if defined(SYS_solaris) || defined(SYS_elf)
 #define Call_gen_code _call_gen_code
 #define Caml_c_call _caml_c_call
 #else
-- 
